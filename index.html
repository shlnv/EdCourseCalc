<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calc</title>
</head>
<body>
<div>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300&family=Pathway+Gothic+One&display=swap');

        #calcWrapper {
            display: none;
            background-color: rgba(255, 255, 255, 1);
            font-family: 'Montserrat', sans-serif;
            width: 1216px;
            border-radius: 16px;
            box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.1);
            padding: 23px 40px 40px 23px;;
        }

        #calcHeader {
            display: inline-block;
            color: rgba(134, 68, 215, 1);
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            text-align: left;
            vertical-align: top;
            letter-spacing: .15rem;
            margin-bottom: 5px;
        }

        #calcLogo {
            position: relative;
            display: inline-block;
            width: 187px;
            height: 95px;
            float: right;
        }

        #calcSubHeader {
            display: inline-block;
            margin-top: 10px;
            margin-bottom: 20px;
            color: rgba(75, 80, 97, 1);
            letter-spacing: .15rem;
        }

        #SLAndCourseSwitchWrapper {
            font-size: 0;
            display: grid;
            align-items: center;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            grid-template-rows: auto;
            grid-template-areas:
            "text1 buttons1 . ."
            "gap . . ."
            "text2 longReadWrapper videoCourseWrapper trainerWrapper";
        }

        .buttonAndExampleWrapper {
            display: inline;
            width: 240px;
            text-align: right;
        }

        #longReadWrapper {
            grid-area: longReadWrapper;
        }

        #videoCourseWrapper {
            grid-area: videoCourseWrapper;
        }

        #trainerWrapper {
            grid-area: trainerWrapper;
        }

        #SLChoiceText {
            grid-area: text1;
            font-size: 20px;
            color: rgba(75, 80, 97, 1);
            width: 347px;
        }

        #SLChoiceButtonsWrapper {
            grid-area: buttons1;
        }

        .calcGridGap {
            grid-area: gap;
            height: 25px;
        }

        #chooseCourseText {
            display: none;
            grid-area: text2;
            font-size: 20px;
        }

        #SLYesButton {
            display: inline-block;
            font-size: 20px;
            width: 120px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 25px 0 0 25px;
            margin: 0;
        }

        #SLNoButton {
            display: inline-block;
            font-size: 20px;
            width: 120px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 0 25px 25px 0;
            margin: 0;
        }

        .calcButton {
            background-color: rgba(255, 255, 255, 1);
            margin-top: 20px;
        }

        .calcButton:hover {
            background-color: orange;
            cursor: pointer;
        }

        .calcButton:active {
            background-color: darkorange;
        }

        .calcButtonPressed {
            background-color: rgba(255, 210, 0, 1);
        }

        .chooseCourseButton {
            display: none;
            font-size: 20px;
            width: 240px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 1);
        }

        .chooseCourseButton:hover {
            background-color: orange;
            cursor: pointer;
        }

        .chooseCourseButton:active {
            background-color: darkorange;
        }

        .chooseCourseButtonSelected {
            background-color: rgba(255, 210, 0, 1);
        }

        .chooseCourseButtonNotSelected {
            border: 3px solid rgba(221, 221, 221, 1);
            color: rgba(221, 221, 221, 1);
        }

        .calcExampleLink {
            color: rgba(75, 80, 97, 1);
            font-size: 10px;
            text-decoration: none;
            border-bottom: 1px dashed rgba(75, 80, 97, 1);
            display: none;
        }

        .calcExampleLink:hover {
            color: blue;
            cursor: pointer;
        }

        .calcExampleLink:visited {
            color: rgba(75, 80, 97, 1);
        }

        #calcCart {
            display: grid;
            align-items: center;
            grid-template-columns: 0.3fr 1.2fr 1.5fr 0.5fr 0.5fr 0.5fr;
            grid-template-rows: auto;
            grid-template-areas:
            "cartHeader cartHeader . . calcCurrencies ."
            ". unitList calcInCart unitQuantity unitPrice ."
            ". . . . totalPrice totalPrice"
            ". . . . calcSubmitButton calcSubmitButton"
        }

        #cartHeader {
            grid-area: cartHeader;
        }

        #calcCurrencies {
            grid-area: calcCurrencies;
        }

        #unitList {
            grid-area: unitList;
        }

        #calcInCart {
            grid-area: calcInCart;
        }

        #unitQuantity {
            grid-area: unitQuantity;
        }

        #unitPrice {
            grid-area: unitPrice;
        }

        #totalPrice {
            grid-area: totalPrice;
        }

        #calcSubmitButton {
            grid-area: calcSubmitButton;
        }

        .calcPlusMinus {
            display: inline-block;
            border: 1px solid rgba(75, 80, 97, 1);
            background-color: rgba(255, 255, 255, 1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .calcPlusMinus:hover {
            cursor: pointer;
            color: rgba(134, 68, 215, 1);
        }

        .calcPlusMinus:active {
            cursor: pointer;
            color: blue;
        }

        #calcHide {
            display: none;
        }

    </style>

    <div id="calcWrapper">
        <h1 id="calcHeader">КАЛЬКУЛЯТОР КУРСА</h1>
        <img src="https://downloader.disk.yandex.ru/preview/75ead0cec289444e37160f97fbed503e13b7560713b4b25ab4d6efcd9a5f06e7/6325ecbe/6BT_65iy4PXvu2PF0YpJ6D14QMkfvcNQtXs-2_Y00s8dlFBC17CHsnKS2hMMDK46hUoqW2j11FiUO_Ru2YXPJw%3D%3D?uid=0&filename=logo-04.png&disposition=inline&hash=&limit=0&content_type=image%2Fpng&owner_uid=0&tknv=v2&size=2048x2048"
             alt="logo"
             id="calcLogo">
        <br>
        <h3 id="calcSubHeader">ВЫБЕРИТЕ НУЖНЫЕ ВАМ ХАРАКТЕРИСТИКИ</h3>
        <br>
        <div id="SLAndCourseSwitchWrapper">
            <span id="SLChoiceText">Разработка курса в соответствии с вашим фирменным стилем?</span>
            <div id="SLChoiceButtonsWrapper">
                <button id="SLYesButton" class="calcButton">ДА</button>
                <button id="SLNoButton" class="calcButton">НЕТ</button>
            </div>
            <div class="calcGridGap"></div>
            <span id="chooseCourseText">Какой курс вам нужен?</span>
            <div id="longReadWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="longReadButton">ЛОНГРИД</button>
                <a id="longreadExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
            <div id="videoCourseWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="videoCourseButton">ВИДЕОКУРС</button>
                <a id="videoCourseExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
            <div id="trainerWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="trainerButton">ТРЕНАЖЁР</button>
                <a id="trainerExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
        </div>
        <div id="calcHide">
            <div id="calcCart">
                <span id="cartHeader">Выберите нужные блоки</span>
                <div id="calcCurrencies">
                    <span>&#8381;</span>
                    <span>$</span>
                    <span>&#8376;</span>
                </div>
                <form id="unitList"></form>
                <div id="calcInCart"></div>
                <div id="unitQuantity"></div>
                <div id="unitPrice"></div>
                <div id="totalPrice"></div>
                <button id="calcSubmitButton">Заказать курс</button>
            </div>
        </div>
    </div>

    <script>
        console.log(window.navigator.userAgent);

        const calc = () => {

            class Data {
                #url;
                #data;
                #profitMultiplier;
                #constantExpenses;
                #constantExpensesPure;
                #courseBranding;
                #constantExpensesRUB;
                #constantExpensesUSD;
                #constantExpensesKZT;
                #units;
                #bankOfRussiaAPI;
                #usd;
                #kzt;

                constructor() {
                    this.#url = 'https://script.google.com/macros/s/AKfycbyvuqVCLoujMoF4fEQIVzlx78E3DVLgD9fEfxKTaG2D-Z5ctCMPewsrsQCl4OH_qJaC/exec';
                    this.#bankOfRussiaAPI = 'https://www.cbr-xml-daily.ru/daily_json.js';
                }

                getFromAPI = async () => {
                    this.#data = await this.fetchData(this.#url);
                    this.#profitMultiplier = +this.#data[0][0].amount;
                    this.#constantExpenses = +this.#data[0][1].amount;
                    this.#constantExpensesPure = this.#constantExpenses;
                    this.#courseBranding = this.#data[0][2];
                    this.#units = this.#data[1];
                    this.#units.forEach((unit, i) => {
                        if (unit.toolSwitcher === '')
                            unit.toolSwitcher = false;
                        unit.name = unit.nameRiseNameBase;
                        unit.longread = +unit.longread;
                        unit.videocourse = +unit.videocourse;
                        unit.trainer = +unit.trainer;
                        unit.RisePossibility = +unit.RisePossibility;
                        unit.SLPossibility = +unit.SLPossibility;
                        unit.TildaPossibility = +unit.TildaPossibility;
                        unit.index = i;
                        unit.quantityInCart = 0;
                    })
                    return true;
                }

                fetchData = async (url) => {
                    const response = await fetch(url)
                    const data = await response.json();
                    if (data.ok) {
                        return data.data;
                    } else {
                        return new Error('server is not responding')
                    }
                }

                fetchExchangeRates = async () => {
                    const data = await fetch(this.#bankOfRussiaAPI);
                    const rates = await data.json();
                    this.#usd = +rates.Valute.USD.Value;
                    this.#kzt = +rates.Valute.KZT.Value;
                    return true;
                }

                getUSDrate = () => {
                    return this.#usd;
                }

                getKZTrate = () => {
                    return this.#kzt;
                }

                setPrices = () => {
                    this.#units.forEach((unit) => {
                        unit.price = unit.priceRiseBasePrise;
                        unit.RUBprice = unit.price;
                        unit.USDprice = unit.RUBprice / this.#usd;
                        unit.KZTprice = unit.RUBprice / this.#kzt;
                        if (unit.priceSL === '') {
                            unit.priceSL = false;
                        } else {
                            unit.RUBpriceSL = unit.priceSL;
                            unit.USDpriceSL = unit.RUBpriceSL / this.#usd;
                            unit.KZTpriceSL = unit.RUBpriceSL / this.#usd;
                        }
                        if (unit.priceRiseBasePrise === '') {
                            unit.priceRiseBasePrise = false;
                        } else {
                            unit.RUBpriceRise = unit.priceRiseBasePrise;
                            unit.USDpriceRise = unit.RUBpriceRise / this.#usd;
                            unit.KZTpriceRise = unit.RUBpriceRise / this.#usd;
                        }
                        if (unit.priceTilda === '') {
                            unit.priceTilda = false;
                        } else {
                            unit.RUBpriceTilda = unit.priceTilda;
                            unit.USDpriceTilda = unit.RUBpriceTilda / this.#usd;
                            unit.KZTpriceTilda = unit.RUBpriceTilda / this.#usd;
                        }
                    });
                    this.#constantExpensesRUB = this.#constantExpenses;
                    this.#constantExpensesUSD = this.#constantExpensesRUB / this.#usd;
                    this.#constantExpensesKZT = this.#constantExpensesRUB / this.#kzt;
                }

                setSLPrices = (cur) => {
                    this.#units.forEach((unit) => {
                        if (unit.SLPossibility) {
                            unit.price = unit.priceSL;
                        }
                    })
                }

                setRisePrices = () => {
                    this.#units.forEach((unit) => {
                        if (unit.priceSL) {
                            unit.price = unit.priceRise;
                        }
                    })
                }


                setCurrency = (cur) => {
                    switch (cur) {
                        case 'USD':
                            this.#units.forEach((unit) => {
                                unit.price = unit.USDprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.USDpriceSL;
                                }
                            });
                            this.#constantExpenses = this.#constantExpensesUSD;
                        case 'KZT':
                            this.#units.forEach((unit) => {
                                unit.price = unit.KZTprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.KZTpriceSL;
                                }
                            })
                            this.#constantExpenses = this.#constantExpensesKZT;
                        case 'RUB':
                            this.#units.forEach((unit) => {
                                unit.price = unit.RUBprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.RUBpriceSL;
                                }
                            })
                            this.#constantExpenses = this.#constantExpensesRUB;

                    }
                }

                getProfitMultiplier = () => {
                    return this.#profitMultiplier;
                }

                getConstantExpenses = () => {
                    return this.#constantExpenses;
                }

                getUnits = () => {
                    return this.#units;
                }

                sendOrder = async (cart, userData) => {

                    class Order {
                        constructor(email, units, totalPrice) {
                            this.email = email
                            this.units = units;
                            this.totalPrice = totalPrice;
                        }
                    }

                    class OrderedUnit {
                        constructor(id, name, purePrice, priceWithExpenses) {
                            this.id = id;
                            this.name = name;
                            this.purePrice = purePrice;
                            this.priceWithExpenses = priceWithExpenses;
                        }
                    }

                    if (cart.length > 0) {
                        let total = 0;
                        const orderedUnits = cart.map((el) => {
                            total += el.fullPrice;
                            return new OrderedUnit(el.id, el.name, el.price.toFixed(2), el.fullPrice.toFixed(2));
                        })
                        const dto = new Order(userData, orderedUnits, total.toFixed(2));
                        const response = await fetch(this.#url, {
                            method: 'POST',
                            mode: 'no-cors',
                            body: JSON.stringify(dto)
                        })
                    }
                }
            };

            class UseCases {
                #data;
                #cart;
                #total;
                #userData;
                #slSwitch;
                #tildaSwitch;
                #designSwitch
                #currency;
                #numberOfPositions

                constructor(data) {
                    this.#data = data;
                    this.#cart = [];
                    this.#total = 0;
                    this.#slSwitch = false;
                    this.#tildaSwitch = false;
                    this.#designSwitch = false;
                    this.#currency = 'RUB';
                    this.#numberOfPositions = 0;
                }

                oneUnitFullPriceFormula = (x) => {
                    return ((x.price * x.quantityInCart) + this.#data.getConstantExpenses() / this.#numberOfPositions) * (1 + +this.#data.getProfitMultiplier());
                }

                slSwitchOn = () => {
                    this.#slSwitch = true;
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.SLPossibility) {
                            unit.name = unit.nameSL;
                            unit.price = unit.priceSL;
                        }
                    })
                }

                designSwitchOn = () => {
                    this.#designSwitch = true;
                }

                designSwitchOff = () => {
                    this.#designSwitch = false;
                }

                getDesignSwitch = () => {
                    return this.#designSwitch;
                }

                slSwitchOff = () => {
                    this.#slSwitch = false;
                    if (this.#tildaSwitch) {
                        this.#data.getUnits().forEach((unit) => {
                            if (unit.TildaPossibility) {
                                unit.name = unit.nameTilda;
                                unit.price = unit.priceTilda;
                            }
                        })
                    } else {
                        this.#data.getUnits().forEach((unit) => {
                            if (unit.RisePossibility) {
                                unit.name = unit.nameRiseNameBase;
                                unit.price = unit.priceRiseBasePrise;
                            }
                        })
                    }
                }

                tildaSwitchOn = () => {
                    this.#tildaSwitch = true;
                    this.#data.getUnits.forEach((unit) => {
                        if (!this.#slSwitch && unit.TildaPossibility) {
                            unit.name = unit.nameTilda;
                            unit.price = unit.priceTilda;
                        }
                    })
                }

                tildaSwitchOff = () => {
                    this.#tildaSwitch = false;
                    this.#data.getUnits.forEach((unit) => {
                        if (!this.#slSwitch && unit.TildaPossibility) {
                            unit.name = unit.nameRiseNameBase;
                            unit.price = unit.priceRiseBasePrise;
                        }
                    })
                }

                addToCart = (index) => {
                    this.#cart.push(this.#data.getUnits()[index]);
                    this.setTotal();
                    return this.#cart;
                };

                submit = (func) => {
                    func(this.#cart, this.#userData);
                    return this.clearCart();
                };

                enterUserData = (userData) => {
                    this.#userData = userData;
                    return this.submit(this.#data.sendOrder);
                }

                removeOneFromCart = (index) => {
                    this.#cart.splice(index, 1);
                    this.setTotal();
                    return this.#cart;
                }

                clearCart = () => {
                    this.#cart = [];
                    this.setTotal();
                    return this.#cart;
                }

                setTotal = () => {
                    if (this.#designSwitch) {
                        //TODO
                        this.#total = 0
                    } else {
                        this.#total = 0;
                    }
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.quantityInCart) {
                            unit.fullPrice = this.oneUnitFullPriceFormula(unit);
                            this.#total += unit.fullPrice;
                        }
                    })
                }

                getTotal = () => {
                    return this.#total;
                }

                longreadFilter = () => {
                    let longreadList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.longread) {
                            longreadList.push(unit);
                        }
                    });
                    return longreadList;
                }

                videocourseFilter = () => {
                    let videocourseList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.videocourse) {
                            videocourseList.push(unit)
                        }
                    });
                    return videocourseList;
                };

                trainerFilter = () => {
                    let trainerList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.trainer) {
                            trainerList.push(unit);
                        }
                    });
                    return trainerList;
                }

                getCart = () => {
                    return this.#cart;
                }

                getUnits = () => {
                    return this.#data.getUnits();
                }

                quantityInCartIncrement(index) {
                    this.#data.getUnits()[index].quantityInCart++;
                    this.#numberOfPositions++
                }

                quantityInCartDecrement(index) {
                    this.#data.getUnits()[index].quantityInCart--;
                    this.#numberOfPositions--;
                }
            };

            class Draw {
                #useCases;
                #filter;

                constructor(useCases) {
                    this.#useCases = useCases;
                    this.chooseCourseText = document.getElementById('chooseCourseText')
                    this.chooseCourseButtons = document.getElementsByClassName('chooseCourseButton');
                    this.SLYesButton = document.getElementById('SLYesButton');
                    this.SLNoButton = document.getElementById('SLNoButton');
                    this.longreadExampleLink = document.getElementById('longreadExampleLink');
                    this.videoCourseExampleLink = document.getElementById('videoCourseExampleLink');
                    this.trainerExampleLink = document.getElementById('trainerExampleLink');
                    this.calcHide = document.getElementById('calcHide');
                    this.SLYesButton.addEventListener('click', () => {
                        this.SLYesButton.classList.remove('calcButton');
                        this.SLYesButton.classList.add('calcButtonPressed');
                        this.SLNoButton.classList.remove('calcButtonPressed');
                        this.SLNoButton.classList.add('calcButton');
                        this.chooseCourseText.style.display = 'inline';
                        for (let chooseCourseButton of this.chooseCourseButtons) {
                            chooseCourseButton.style.display = 'inline';
                        }
                        this.#useCases.slSwitchOn();
                        this.#useCases.designSwitchOn();
                        this.renderUnitListWithFilters();
                        this.renderCart();
                    });
                    this.SLNoButton.addEventListener('click', () => {
                        this.SLNoButton.classList.remove('calcButton');
                        this.SLNoButton.classList.add('calcButtonPressed');
                        this.SLYesButton.classList.remove('calcButtonPressed');
                        this.SLYesButton.classList.add('calcButton');
                        this.chooseCourseText.style.display = 'inline';
                        for (let chooseCourseButton of this.chooseCourseButtons) {
                            chooseCourseButton.style.display = 'inline';
                        }
                        this.#useCases.slSwitchOff();
                        this.#useCases.designSwitchOff();
                        this.renderUnitListWithFilters();
                        this.renderCart();
                    });
                    this.longReadButton = document.getElementById('longReadButton');
                    this.videoCourseButton = document.getElementById('videoCourseButton');
                    this.trainerButton = document.getElementById('trainerButton');
                    this.longReadButton.addEventListener('click', () => {
                        this.#filter = 'LONGREAD';
                        this.longReadButton.classList.remove('chooseCourseButtonNotSelected');
                        this.longReadButton.classList.add('chooseCourseButtonSelected');
                        this.videoCourseButton.classList.remove('chooseCourseButtonSelected');
                        this.videoCourseButton.classList.add('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.remove('chooseCourseButtonSelected');
                        this.trainerButton.classList.add('chooseCourseButtonNotSelected');
                        this.longreadExampleLink.style.display = 'inline';
                        this.videoCourseExampleLink.style.display = 'none';
                        this.trainerExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.longreadFilter());
                        this.calcHide.style.display = 'block';
                    });
                    this.videoCourseButton.addEventListener('click', () => {
                        this.#filter = 'VIDEOCOURSE';
                        this.videoCourseButton.classList.remove('chooseCourseButtonNotSelected');
                        this.videoCourseButton.classList.add('chooseCourseButtonSelected');
                        this.longReadButton.classList.remove('chooseCourseButtonSelected');
                        this.longReadButton.classList.add('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.remove('chooseCourseButtonSelected');
                        this.trainerButton.classList.add('chooseCourseButtonNotSelected');
                        this.videoCourseExampleLink.style.display = 'inline';
                        this.longreadExampleLink.style.display = 'none';
                        this.trainerExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.videocourseFilter());
                        this.calcHide.style.display = 'block';
                    });
                    this.trainerButton.addEventListener('click', () => {
                        this.#filter = 'TRAINER';
                        this.trainerButton.classList.remove('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.add('chooseCourseButtonSelected');
                        this.longReadButton.classList.remove('chooseCourseButtonSelected');
                        this.longReadButton.classList.add('chooseCourseButtonNotSelected');
                        this.videoCourseButton.classList.remove('chooseCourseButtonSelected');
                        this.videoCourseButton.classList.add('chooseCourseButtonNotSelected');
                        this.trainerExampleLink.style.display = 'inline';
                        this.longreadExampleLink.style.display = 'none';
                        this.videoCourseExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.trainerFilter());
                        this.calcHide.style.display = 'block';
                    });

                    this.unitList = document.getElementById('unitList');
                    this.cartUnits = document.getElementById('calcInCart');
                    this.cartQuantity = document.getElementById('unitQuantity');
                    this.cartPrices = document.getElementById('unitPrice');
                    this.cartTotalPrice = document.getElementById('totalPrice');
                }

                openCalc = () => {
                    const calc = document.getElementById('calcWrapper');
                    calc.style.display = 'block';
                }

                renderUnitList = (units) => {
                    this.unitList.innerHTML = '';
                    units.forEach((unit, i) => {
                        const div = document.createElement('div')
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.id = unit.id;
                        input.dataset.index = unit.index;
                        input.className = 'unitAtList';
                        if (unit.quantityInCart) {
                            input.checked = true;
                        }
                        input.onchange = this.selectFromUnitList;
                        const label = document.createElement('label');
                        label.htmlFor = input.id;
                        const textContent = document.createTextNode(unit.name);
                        label.appendChild(textContent);
                        div.appendChild(input);
                        div.appendChild(label);
                        this.unitList.appendChild(div)
                    })
                }

                selectFromUnitList = (e) => {
                    if (e.target.checked) {
                        this.#useCases.quantityInCartIncrement(e.target.dataset.index);
                    } else {
                        this.#useCases.getUnits()[e.target.dataset.index].quantityInCart = 0;
                    }
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                renderCart = () => {
                    this.cartUnits.innerHTML = '';
                    this.cartPrices.innerHTML = '';
                    this.cartQuantity.innerHTML = '';
                    if (this.#useCases.getDesignSwitch()) {

                    }
                    this.#useCases.getUnits().forEach((unit, i) => {
                        if (unit.quantityInCart) {
                            const inCartLineUnit = document.createElement('div');
                            inCartLineUnit.className = 'inCartLineUnit';
                            inCartLineUnit.dataset.index = unit.index;
                            inCartLineUnit.addEventListener('mouseover', () => {
                            });
                            inCartLineUnit.addEventListener('mouseleave', () => {
                            })
                            const inCartLinePrice = document.createElement('div');
                            inCartLinePrice.dataset.index = unit.index;
                            inCartLinePrice.className = 'inCartLinePrice';
                            inCartLinePrice.addEventListener('mouseover', () => {
                            });
                            inCartLinePrice.addEventListener('mouseleave', () => {
                            })
                            const textContentUnit = document.createTextNode(unit.name);
                            const textContentPrice = document.createTextNode(unit.fullPrice.toFixed(2));
                            const quantityWrapper = document.createElement('div');
                            const plus = document.createElement('button');
                            quantityWrapper.appendChild(plus);
                            const textPlus = document.createTextNode('+');
                            plus.appendChild(textPlus);
                            plus.className = 'calcPlusMinus';
                            plus.dataset.index = unit.index;
                            plus.addEventListener('click', () => this.onPlus(unit.index));
                            const quantity = document.createElement('span');
                            quantityWrapper.appendChild(quantity);
                            const quantityText = document.createTextNode(' ' + unit.quantityInCart + ' ');
                            quantity.appendChild(quantityText);
                            const minus = document.createElement('button');
                            quantityWrapper.appendChild(minus);
                            const textMinus = document.createTextNode('-');
                            minus.appendChild(textMinus);
                            minus.className = 'calcPlusMinus';
                            minus.dataset.index = unit.index;
                            //TODO
                            minus.addEventListener('click', () => this.onMinus(unit.index));
                            inCartLineUnit.appendChild(textContentUnit);
                            inCartLinePrice.appendChild(textContentPrice);
                            this.cartUnits.appendChild(inCartLineUnit);
                            this.cartPrices.appendChild(inCartLinePrice);
                            this.cartQuantity.appendChild(quantityWrapper);
                        }
                    })
                    const totalPrice = document.getElementById('totalPrice');
                    const textContentTotal = document.createTextNode(this.#useCases.getTotal().toFixed(2).toString());
                    totalPrice.innerHTML = '';
                    totalPrice.appendChild(textContentTotal);
                };

                onPlus = (index) => {
                    this.#useCases.quantityInCartIncrement(index);
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                onMinus = (index) => {
                    this.#useCases.quantityInCartDecrement(index);
                    const unit = this.#useCases.getUnits()[index];
                    if (unit.quantityInCart == 0) {
                        const check = document.getElementById(unit.id);
                        check.checked = false;
                    }
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                renderUnitListWithFilters = () => {
                    switch (this.#filter) {
                        case 'LONGREAD':
                            console.log('case longread')
                            this.renderUnitList(this.#useCases.longreadFilter());
                        case 'VIDEOCOURSE':
                            this.renderUnitList(this.#useCases.videocourseFilter());
                        case 'TRAINER':
                            this.renderUnitList(this.#useCases.trainerFilter());
                    }
                }

//TODO
                static serverError = (e) => {
                    console.log(e);
                }

//                 sendCart = () => {
//                     const calcWrapper = document.getElementById('calcWrapper');
//                     calcWrapper.classList.add('loadingCalc');
//                     const cart = this.#useCases.enterUserData(prompt('Введите ваш телефон или e-mail', ''));
//                     alert('Наш сотрудник свяжется с вами в ближайшее время');
//                     calcWrapper.classList.remove('loadingCalc');
//                     this.renderCart(cart);
//                 }
//
//                 whatColumn = (e) => {
//                     const el1 = e.target;
//                     let el2;
//                     const index = +el1.dataset.index;
//                     if (el1.classList.contains('inCartLineUnit')) {
//                         const cartPrices = document.querySelectorAll('.inCartLinePrice');
//                         el2 = cartPrices.item(index + 1);
//                     } else {
//                         const cartUnits = document.querySelectorAll('.inCartLineUnit');
//                         el2 = cartUnits.item(index + 1);
//                     }
//                     return [el1, el2];
//                 }
//
//                 highlightLine = (e) => {
//                     const [el1, el2] = this.whatColumn(e);
//                     el1.classList.add('highlightUnit');
//                     el2.classList.add('highlightUnit');
//                 }
//
//                 removeHighlight = (e) => {
//                     const [el1, el2] = this.whatColumn(e);
//                     el1.classList.remove('highlightUnit');
//                     el2.classList.remove('highlightUnit');
//                 }
            };

            const run = async () => {
                let success = false;
                const data = new Data();
                try {
                    success = await data.getFromAPI();
                } catch (e) {
                    console.log('caught data.getFromAPI()');
                    Draw.serverError(e);
                }
                if (success) {
                    const useCases = new UseCases(data);
                    const draw = new Draw(useCases);
                    draw.openCalc();
                    // draw.createUnitList(data.getUnits());
                }
                try {
                    if (success) {
                        success = await data.fetchExchangeRates()
                    }
                } catch (e) {
                    console.log('caught data.fetchExchangeRates error')
                    Draw.serverError(e);
                }
                if (success) {
                    await data.setPrices();
                }
            }
            run();
        };
        calc();

    </script>
</div>
</body>
</html>