<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Calc</title>
</head>
<body>
<div>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300&family=Pathway+Gothic+One&display=swap');

        #calcWrapper {
            display: none;
            background-color: rgba(255, 255, 255, 1);
            font-family: 'Montserrat', sans-serif;
            width: 1216px;
            border-radius: 16px;
            box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.1);
            padding: 23px 40px 40px 23px;;
        }

        #calcHeader {
            display: inline-block;
            color: rgba(134, 68, 215, 1);
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            text-align: left;
            vertical-align: top;
            letter-spacing: .15rem;
            margin-bottom: 5px;
        }

        #calcLogo {
            position: relative;
            display: inline-block;
            width: 187px;
            height: 95px;
            float: right;
        }

        #calcSubHeader {
            display: inline-block;
            margin-top: 10px;
            margin-bottom: 20px;
            color: rgba(75, 80, 97, 1);
            letter-spacing: .15rem;
        }

        #SLAndCourseSwitchWrapper {
            font-size: 0;
            display: grid;
            align-items: center;
            grid-template-columns: 1.5fr 1fr 1fr 1fr;
            grid-template-rows: auto;
            grid-template-areas:
            "text1 buttons1 . ."
            "gap . . ."
            "text2 longReadWrapper videoCourseWrapper trainerWrapper";
        }

        .buttonAndExampleWrapper {
            display: inline;
            width: 240px;
            text-align: right;
        }

        #longReadWrapper {
            grid-area: longReadWrapper;
        }

        #videoCourseWrapper {
            grid-area: videoCourseWrapper;
        }

        #trainerWrapper {
            grid-area: trainerWrapper;
        }

        #SLChoiceText {
            grid-area: text1;
            font-size: 20px;
            color: rgba(75, 80, 97, 1);
            width: 347px;
        }

        #SLChoiceButtonsWrapper {
            grid-area: buttons1;
        }

        .calcGridGap {
            grid-area: gap;
            height: 25px;
        }

        #chooseCourseText {
            display: none;
            grid-area: text2;
            font-size: 20px;
        }

        #SLYesButton {
            display: inline-block;
            font-size: 20px;
            width: 120px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 25px 0 0 25px;
            margin: 0;
        }

        #SLNoButton {
            display: inline-block;
            font-size: 20px;
            width: 120px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 0 25px 25px 0;
            margin: 0;
        }

        #SLYesButton:disabled {
            color: black;
        }

        #SLNoButton:disabled {
            color: black;
        }

        .calcButton {
            background-color: rgba(255, 255, 255, 1);
            margin-top: 20px;
        }

        .calcButton:hover {
            background-color: orange;
            cursor: pointer;
        }

        .calcButton:active {
            background-color: darkorange;
        }

        .calcButtonPressed {
            background-color: rgba(255, 210, 0, 1);
        }

        #longReadButton:disabled {
            color: black;
        }

        #videoCourseButton:disabled {
            color: black;
        }

        #trainerButton:disabled {
            color: black;
        }

        .chooseCourseButton {
            display: none;
            font-size: 20px;
            width: 240px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 25px;
            background-color: rgba(255, 255, 255, 1);
        }

        .chooseCourseButton:hover {
            background-color: orange;
            cursor: pointer;
        }

        .chooseCourseButton:active {
            background-color: darkorange;
        }

        .chooseCourseButtonSelected {
            font-size: 20px;
            width: 240px;
            height: 46px;
            border: 3px solid rgba(255, 210, 0, 1);
            border-radius: 25px;
            background-color: rgba(255, 210, 0, 1);
        }

        .chooseCourseButtonNotSelected {
            border: 3px solid rgba(221, 221, 221, 1);
            color: rgba(221, 221, 221, 1);
        }

        .calcExampleLink {
            color: rgba(75, 80, 97, 1);
            font-size: 10px;
            text-decoration: none;
            border-bottom: 1px dashed rgba(75, 80, 97, 1);
            display: none;
        }

        .calcExampleLink:hover {
            color: blue;
            cursor: pointer;
        }

        .calcExampleLink:visited {
            color: rgba(75, 80, 97, 1);
        }

        #calcCart {
            margin-top: 20px;
            display: grid;
            align-items: center;
            grid-template-columns: 0.3fr 1.2fr 1.5fr 0.5fr 0.5fr 0.5fr;
            grid-template-rows: auto;
            grid-column-gap: 10px;
            grid-row-gap: 10px;
            grid-template-areas:
            "cartHeader cartHeader . . calcCurrencies ."
            ". unitList calcInCart unitQuantity unitPrice ."
            ". . . . totalPrice totalPrice"
            ". . . . calcSubmitButton calcSubmitButton"
        }

        #cartHeader {
            grid-area: cartHeader;
            font-size: 20px;
            color: #8644D7;
        }

        #calcCurrencies {
            grid-area: calcCurrencies;
            text-align: center;
        }

        #unitList {
            grid-area: unitList;
        }

        .unitAtList {
            width: 10px;
            height: 11px;
            border: 1px solid rgba(75, 80, 97, 1);
            border-radius: 2px;
        }

        .unitAtList:checked:after {
            position: relative;
            left: -1px;
            line-height: 0.9em;
            display: flex;
            box-sizing: content-box;
            align-items: end;
            width: 10px;
            height: 11px;
            border: 1px solid rgba(221, 221, 221, 1);
            border-radius: 2px;
            content: '\2713';
            font-size: 20px;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 1);
            color: #8644D7;
        }

        .unitLabel {
            margin-left: 12px;
        }

        .unitCheckboxWrapper {
            margin-bottom: 12px;
        }

        #calcInCart {
            grid-area: calcInCart;
        }

        #unitQuantity {
            grid-area: unitQuantity;
        }

        #unitPrice {
            grid-area: unitPrice;
        }

        #totalPrice {
            grid-area: totalPrice;
        }

        #calcSubmitButton {
            grid-area: calcSubmitButton;

        }

        .calcPlusMinus {
            display: inline-block;
            border: 1px solid rgba(75, 80, 97, 1);
            background-color: rgba(255, 255, 255, 1);
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .calcPlusMinus:hover {
            cursor: pointer;
            color: rgba(134, 68, 215, 1);
        }

        .calcPlusMinus:active {
            cursor: pointer;
            color: blue;
        }

        #calcHide {
            display: none;
        }

        #rubleButton {
            display: inline-block;
            float: left;
        }

        #dollarButton {
        }

        #tengeButton {
            display: inline-block;
            float: right;
        }

        .currencyButton:hover {
            cursor: pointer;
        }

        .calcModalWindow {
            width: 280px;
            height: 336px;
            background-color: rgba(255, 255, 255, 1);
            font-family: 'Montserrat', sans-serif;
            border-radius: 16px;
            box-shadow: 0 0 6px 0 rgba(0, 0, 0, 0.1);
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            margin: auto;

        }

        #userDataWindow {
            display: none;
        }

        #thanksWindow {
            display: none;
        }

        .calcModalClose {
            float: right;
            position: relative;
            top: 15px;
            right: 20px;
        }

        #calcModalClose:hover {
            cursor: pointer;
        }

        #calcDark {
            background: rgba(102, 102, 102, 0.5);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
        }

    </style>

    <div id="calcWrapper">

        <h1 id="calcHeader">КАЛЬКУЛЯТОР КУРСА</h1>
        <img src="https://downloader.disk.yandex.ru/preview/75ead0cec289444e37160f97fbed503e13b7560713b4b25ab4d6efcd9a5f06e7/6325ecbe/6BT_65iy4PXvu2PF0YpJ6D14QMkfvcNQtXs-2_Y00s8dlFBC17CHsnKS2hMMDK46hUoqW2j11FiUO_Ru2YXPJw%3D%3D?uid=0&filename=logo-04.png&disposition=inline&hash=&limit=0&content_type=image%2Fpng&owner_uid=0&tknv=v2&size=2048x2048"
             alt="logo"
             id="calcLogo">
        <br>
        <h3 id="calcSubHeader">ВЫБЕРИТЕ НУЖНЫЕ ВАМ ХАРАКТЕРИСТИКИ</h3>
        <br>
        <div id="SLAndCourseSwitchWrapper">
            <span id="SLChoiceText">Разработка курса в соответствии с вашим фирменным стилем?</span>
            <div id="SLChoiceButtonsWrapper">
                <button id="SLYesButton" class="calcButton">ДА</button>
                <button id="SLNoButton" class="calcButton">НЕТ</button>
            </div>
            <div class="calcGridGap"></div>
            <span id="chooseCourseText">Какой курс вам нужен?</span>
            <div id="longReadWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="longReadButton">ЛОНГРИД</button>
                <a id="longreadExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
            <div id="videoCourseWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="videoCourseButton">ВИДЕОКУРС</button>
                <a id="videoCourseExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
            <div id="trainerWrapper" class="buttonAndExampleWrapper">
                <button class="chooseCourseButton" id="trainerButton">ТРЕНАЖЁР</button>
                <a id="trainerExampleLink" class="calcExampleLink">Посмотреть пример курса</a>
            </div>
        </div>
        <div id="calcHide">
            <div id="calcCart">
                <span id="cartHeader">Выберите нужные блоки</span>
                <div id="calcCurrencies">
                    <span id="rubleButton" class="currencyButton">&#8381;</span>
                    <span id="dollarButton" class="currencyButton">$</span>
                    <span id="tengeButton" class="currencyButton">&#8376;</span>
                </div>
                <form id="unitList"></form>
                <div id="calcInCart"></div>
                <div id="unitQuantity"></div>
                <div id="unitPrice"></div>
                <div id="totalPrice"></div>
                <button id="calcSubmitButton" disabled>Заказать курс</button>
            </div>
        </div>
        <div id="calcDark">
            <div id="userDataWindow" class="calcModalWindow">
                <div id="calcModalClose1" class="calcModalClose">X</div>
                <h5>Отправим полный курс на почту</h5>
                <form id="calcUserForm">
                    <input type="email" name="email" placeholder="email" required>
                    <input type="tel" name="phone" placeholder="+7 999 999 99 99" required>
                    <input type="text" name="name" placeholder="Как к вам обращаться?" required>
                    <input type="submit" value="Оставить заявку">
                    <div>Нажатием на «Оставить заявку» подтверждаю согласие с обработкой персональный данных</div>
                </form>
                <h5>Можете нам написать</h5>
            </div>
            <div id="thanksWindow" class="calcModalWindow">
                <div id="calcModalClose2" class="calcModalClose">X</div>
                <h5>Спасибо за интерес к нашим курсам</h5>
                <p>Наш специалист свяжется с вами и проконсультирует по выбранному курсу</p>
                <h5>Можете нам написать</h5>
            </div>
        </div>
    </div>

    <script>
        console.log(window.navigator.userAgent);

        const YES_NO_BUTTON_UNIT_ID = 'UT-007'

        const calc = () => {

            class Data {
                #url;
                #data;
                #profitMultiplier;
                #constantExpenses;
                #constantExpensesPure;
                #courseBranding;
                #constantExpensesRUB;
                #constantExpensesUSD;
                #constantExpensesKZT;
                #units;
                #bankOfRussiaAPI;
                #usd;
                #kzt;

                constructor() {
                    this.#url = 'https://script.google.com/macros/s/AKfycbyvuqVCLoujMoF4fEQIVzlx78E3DVLgD9fEfxKTaG2D-Z5ctCMPewsrsQCl4OH_qJaC/exec';
                    this.#bankOfRussiaAPI = 'https://www.cbr-xml-daily.ru/daily_json.js';
                }

                getFromAPI = async () => {
                    this.#data = await this.fetchData(this.#url);
                    this.#profitMultiplier = +this.#data[0][0].amount;
                    this.#constantExpenses = +this.#data[0][1].amount;
                    this.#constantExpensesPure = this.#constantExpenses;
                    this.#courseBranding = this.#data[0][2];
                    this.#units = this.#data[1];
                    this.#units.forEach((unit, i) => {
                        if (unit.toolSwitcher === '')
                            unit.toolSwitcher = false;
                        unit.innerName = unit.nameRiseNameBase;
                        unit.longread = +unit.longread;
                        unit.videocourse = +unit.videocourse;
                        unit.trainer = +unit.trainer;
                        unit.RisePossibility = +unit.RisePossibility;
                        unit.SLPossibility = +unit.SLPossibility;
                        unit.TildaPossibility = +unit.TildaPossibility;
                        unit.single = +unit.single;
                        unit.index = i;
                        unit.quantityInCart = 0;
                    })
                    return true;
                }

                fetchData = async (url) => {
                    const response = await fetch(url)
                    const data = await response.json();
                    if (data.ok) {
                        return data.data;
                    } else {
                        return new Error('server is not responding')
                    }
                }

                fetchExchangeRates = async () => {
                    const data = await fetch(this.#bankOfRussiaAPI);
                    const rates = await data.json();
                    this.#usd = +rates.Valute.USD.Value;
                    this.#kzt = +rates.Valute.KZT.Value;
                    return true;
                }

                setPrices = () => {
                    this.#units.forEach((unit) => {
                        if (unit.toolSwitcher) {
                            if (unit.toolSwitcher.trim().toLowerCase() == 'sl') {
                                unit.price = unit.priceSL;
                            } else if (unit.toolSwitcher.trim().toLowerCase() == 'tilda') {
                                unit.price = unit.priceTilda;
                            } else {
                                unit.price = unit.priceRiseBasePrise;
                            }
                        }
                        unit.RUBprice = unit.price;
                        unit.USDprice = unit.RUBprice / this.#usd;
                        unit.KZTprice = unit.RUBprice / this.#kzt;
                        if (unit.priceSL === '') {
                            unit.priceSL = false;
                        } else {
                            unit.RUBpriceSL = unit.priceSL;
                            unit.USDpriceSL = unit.RUBpriceSL / this.#usd;
                            unit.KZTpriceSL = unit.RUBpriceSL / this.#usd;
                        }
                        if (unit.priceRiseBasePrise === '') {
                            unit.priceRiseBasePrise = false;
                        } else {
                            unit.RUBpriceRise = unit.priceRiseBasePrise;
                            unit.USDpriceRise = unit.RUBpriceRise / this.#usd;
                            unit.KZTpriceRise = unit.RUBpriceRise / this.#usd;
                        }
                        if (unit.priceTilda === '') {
                            unit.priceTilda = false;
                        } else {
                            unit.RUBpriceTilda = unit.priceTilda;
                            unit.USDpriceTilda = unit.RUBpriceTilda / this.#usd;
                            unit.KZTpriceTilda = unit.RUBpriceTilda / this.#usd;
                        }
                    });
                    this.#constantExpensesRUB = this.#constantExpenses;
                    this.#constantExpensesUSD = this.#constantExpensesRUB / this.#usd;
                    this.#constantExpensesKZT = this.#constantExpensesRUB / this.#kzt;
                }

                setSLPrices = (cur) => {
                    this.#units.forEach((unit) => {
                        if (unit.SLPossibility) {
                            unit.price = unit.priceSL;
                        }
                    })
                }

                setRisePrices = () => {
                    this.#units.forEach((unit) => {
                        if (unit.priceSL) {
                            unit.price = unit.priceRise;
                        }
                    })
                }

                setCurrency = (cur) => {
                    switch (cur) {
                        case 'USD':
                            this.#units.forEach((unit) => {
                                // unit.price = unit.USDprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.USDpriceSL;
                                }
                                if (unit.priceRiseBasePrise) {
                                    unit.priceRiseBasePrise = unit.USDpriceRise;
                                }
                                if (unit.priceTilda) {
                                    unit.priceTilda = unit.USDpriceTilda;
                                }
                            });
                            this.#constantExpenses = this.#constantExpensesUSD;
                            break;
                        case 'KZT':
                            this.#units.forEach((unit) => {
                                // unit.price = unit.KZTprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.KZTpriceSL;
                                }
                                if (unit.priceRiseBasePrise) {
                                    unit.priceRiseBasePrise = unit.KZTpriceRise;
                                }
                                if (unit.priceTilda) {
                                    unit.priceTilda = unit.KZTpriceTilda;
                                }
                            })
                            this.#constantExpenses = this.#constantExpensesKZT;
                            break;
                        case 'RUB':
                            this.#units.forEach((unit) => {
                                // unit.price = unit.RUBprice;
                                if (unit.priceSL) {
                                    unit.priceSL = unit.RUBpriceSL;
                                }
                                if (unit.priceRiseBasePrise) {
                                    unit.priceRiseBasePrise = unit.RUBpriceRise;
                                }
                                if (unit.priceTilda) {
                                    unit.priceTilda = unit.RUBpriceTilda;
                                }
                            })
                            this.#constantExpenses = this.#constantExpensesRUB;
                            break;
                    }
                }

                getProfitMultiplier = () => {
                    return this.#profitMultiplier;
                }

                getConstantExpenses = () => {
                    return this.#constantExpenses;
                }

                getUnits = () => {
                    return this.#units;
                }

                sendOrder = async (userData, total, currency) => {
                    const dateNow = Date.now();
                    const units = [];
                    this.#units.forEach((unit) => {
                        if (unit.quantityInCart) {
                            units.push({
                                id: unit.id,
                                name: unit.innerName,
                                nettPrice: `${unit.price.toFixed(2)} ${currency}`,
                                grossPrice: `${unit.fullPrice.toFixed(2)} ${currency}`
                            });
                        }
                    });
                    const order = {
                        id: dateNow,
                        date: new Date(dateNow).toLocaleDateString(),
                        total: `${total.toFixed(2)} ${currency}`,
                        units: units
                    }
                    userData.forEach(obj => {
                        Object.assign(order, {[obj.name]: obj.value});
                    })
                    const response = await fetch(this.#url, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify(order)
                    })
                }
            };

            class UseCases {
                #data;
                #cart;
                #total;
                #slSwitch;
                #tildaSwitch;
                #designSwitch
                #currency;
                #numberOfPositions

                constructor(data) {
                    this.#data = data;
                    this.#cart = [];
                    this.#total = 0;
                    this.#slSwitch = false;
                    this.#tildaSwitch = false;
                    this.#designSwitch = false;
                    this.#currency = 'RUB';
                    this.#numberOfPositions = 0;
                }

                oneUnitFullPriceFormula = (x) => {
                    if (this.#slSwitch && x.priceSL) {
                        x.price = x.priceSL;
                    }
                    if (this.#tildaSwitch && !this.#slSwitch && x.priceTilda) {
                        x.price = x.priceTilda;
                    }
                    if (!this.#slSwitch && !this.#tildaSwitch && x.priceRiseBasePrise) {
                        x.price = x.priceRiseBasePrise;
                    }
                    return (x.price * x.quantityInCart) + this.#data.getConstantExpenses() * (x.quantityInCart / this.#numberOfPositions) * (1 + +this.#data.getProfitMultiplier());
                }

                getSLswitch = () => {
                    return this.#slSwitch;
                }

                getTildaSwitch = () => {
                    return this.#tildaSwitch;
                }

                slSwitchOn = () => {
                    this.#slSwitch = true;
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.SLPossibility) {
                            unit.innerName = unit.nameSL;
                            unit.price = unit.priceSL;
                        }
                    })
                    this.setTotal();
                }

                slSwitchOff = () => {
                    this.#slSwitch = false;
                    if (this.#tildaSwitch) {
                        this.#data.getUnits().forEach((unit) => {
                            if (unit.TildaPossibility) {
                                unit.innerName = unit.nameTilda;
                                unit.price = unit.priceTilda;
                            }
                        })
                    } else {
                        this.#data.getUnits().forEach((unit) => {
                            if (unit.RisePossibility) {
                                unit.innerName = unit.nameRiseNameBase;
                                unit.price = unit.priceRiseBasePrise;
                            }
                        })
                    }
                    this.setTotal();
                }

                getCurrency = () => {
                    return this.#currency;
                }

                tildaSwitchOn = () => {
                    this.#tildaSwitch = true;
                    this.#data.getUnits().forEach((unit) => {
                        if (!this.#slSwitch && unit.TildaPossibility) {
                            unit.innerName = unit.nameTilda;
                            unit.price = unit.priceTilda;
                        }
                    })
                    this.setTotal();
                }

                tildaSwitchOff = () => {
                    this.#tildaSwitch = false;
                    this.#data.getUnits().forEach((unit) => {
                        if (!this.#slSwitch && unit.TildaPossibility) {
                            unit.innerName = unit.nameRiseNameBase;
                            unit.price = unit.priceRiseBasePrise;
                        }
                    })
                    this.setTotal();
                }

                setTotal = () => {
                    this.#total = 0;
                    this.#data.getUnits().forEach((unit) => {
                        unit.fullPrice = this.oneUnitFullPriceFormula(unit);
                        if (unit.quantityInCart) {
                            this.#total += unit.fullPrice;
                        }
                    })
                }

                getTotal = () => {
                    return this.#total;
                }

                longreadFilter = () => {
                    let longreadList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.longread) {
                            longreadList.push(unit);
                        }
                    });
                    return longreadList;
                }

                videocourseFilter = () => {
                    let videocourseList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.videocourse) {
                            videocourseList.push(unit)
                        }
                    });
                    return videocourseList;
                };

                trainerFilter = () => {
                    let trainerList = [];
                    this.#data.getUnits().forEach((unit) => {
                        if (unit.trainer) {
                            trainerList.push(unit);
                        }
                    });
                    return trainerList;
                }

                getUnits = () => {
                    return this.#data.getUnits();
                }

                addToCartById = (id) => {
                    const unitIndex = this.getUnits().findIndex(unit => unit.id == id);
                    this.addToCartByIndex(unitIndex);
                }

                addToCartByIndex = (index) => {
                    this.quantityInCartIncrement(index);
                }

                removeFromCartById = (id) => {
                    const unitIndex = this.getUnits().findIndex(unit => unit.id == id);
                    this.removeFromCartByIndex(unitIndex);
                }

                removeFromCartByIndex = (index) => {
                    this.#numberOfPositions = this.#numberOfPositions - this.getUnits()[index].quantityInCart;
                    this.getUnits()[index].quantityInCart = 0;
                }

                quantityInCartIncrement(index) {
                    this.#data.getUnits()[index].quantityInCart++;
                    this.#numberOfPositions++
                }

                quantityInCartDecrement(index) {
                    this.#data.getUnits()[index].quantityInCart--;
                    this.#numberOfPositions--;
                }

                setRublePrice = () => {
                    this.#currency = 'RUB';
                    this.#data.setCurrency(this.#currency);
                    this.setTotal();
                }

                setDollarPrice = () => {
                    this.#currency = 'USD';
                    this.#data.setCurrency(this.#currency);
                    this.setTotal();
                }

                setTengePrice = () => {
                    this.#currency = 'KZT';
                    this.#data.setCurrency(this.#currency);
                    this.setTotal();
                }

                sendOrder = async (userData) => {
                    await this.#data.sendOrder(userData, this.#total, this.#currency);
                }

                clearCart = () => {
                    this.getUnits().forEach((unit) => {
                        unit.quantityInCart = 0;
                    })
                    this.setTotal();
                }
            };

            class Draw {
                #useCases;
                #filter;

                constructor(useCases) {
                    this.#useCases = useCases;
                    this.chooseCourseText = document.getElementById('chooseCourseText')
                    this.chooseCourseButtons = document.getElementsByClassName('chooseCourseButton');
                    this.SLYesButton = document.getElementById('SLYesButton');
                    this.SLNoButton = document.getElementById('SLNoButton');
                    this.longreadExampleLink = document.getElementById('longreadExampleLink');
                    this.videoCourseExampleLink = document.getElementById('videoCourseExampleLink');
                    this.trainerExampleLink = document.getElementById('trainerExampleLink');
                    this.calcHide = document.getElementById('calcHide');
                    this.SLYesButton.addEventListener('click', () => {
                        this.onYesVisual();
                        return this.onYes();
                    });
                    this.SLNoButton.addEventListener('click', () => {
                        this.onNoVisual();
                        return this.onNo();
                    });
                    this.longReadButton = document.getElementById('longReadButton');
                    this.videoCourseButton = document.getElementById('videoCourseButton');
                    this.trainerButton = document.getElementById('trainerButton');
                    this.longReadButton.addEventListener('click', () => {
                        this.#filter = 'LONGREAD';
                        this.longReadButton.classList.remove('chooseCourseButton');
                        this.longReadButton.classList.remove('chooseCourseButtonNotSelected');
                        this.longReadButton.classList.add('chooseCourseButtonSelected');
                        this.longReadButton.disabled = true;
                        this.videoCourseButton.classList.add('chooseCourseButton');
                        this.videoCourseButton.classList.add('chooseCourseButtonNotSelected');
                        this.videoCourseButton.classList.remove('chooseCourseButtonSelected');
                        this.videoCourseButton.disabled = false;
                        this.trainerButton.classList.add('chooseCourseButton');
                        this.trainerButton.classList.add('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.remove('chooseCourseButtonSelected');
                        this.trainerButton.disabled = false;
                        this.longreadExampleLink.style.display = 'inline';
                        this.videoCourseExampleLink.style.display = 'none';
                        this.trainerExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.longreadFilter());
                        this.calcHide.style.display = 'block';
                    });
                    this.videoCourseButton.addEventListener('click', () => {
                        this.#filter = 'VIDEOCOURSE';
                        this.videoCourseButton.classList.remove('chooseCourseButton');
                        this.videoCourseButton.classList.remove('chooseCourseButtonNotSelected');
                        this.videoCourseButton.classList.add('chooseCourseButtonSelected');
                        this.videoCourseButton.disabled = true;
                        this.longReadButton.classList.add('chooseCourseButton');
                        this.longReadButton.classList.add('chooseCourseButtonNotSelected');
                        this.longReadButton.classList.remove('chooseCourseButtonSelected');
                        this.longReadButton.disabled = false;
                        this.trainerButton.classList.add('chooseCourseButton');
                        this.trainerButton.classList.add('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.remove('chooseCourseButtonSelected');
                        this.trainerButton.disabled = false;
                        this.videoCourseExampleLink.style.display = 'inline';
                        this.longreadExampleLink.style.display = 'none';
                        this.trainerExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.videocourseFilter());
                        this.calcHide.style.display = 'block';
                    });
                    this.trainerButton.addEventListener('click', () => {
                        this.#filter = 'TRAINER';
                        this.trainerButton.classList.remove('chooseCourseButton');
                        this.trainerButton.classList.remove('chooseCourseButtonNotSelected');
                        this.trainerButton.classList.add('chooseCourseButtonSelected');
                        this.trainerButton.disabled = true;
                        this.longReadButton.classList.add('chooseCourseButton');
                        this.longReadButton.classList.add('chooseCourseButtonNotSelected');
                        this.longReadButton.classList.remove('chooseCourseButtonSelected');
                        this.longReadButton.disabled = false;
                        this.videoCourseButton.classList.add('chooseCourseButton');
                        this.videoCourseButton.classList.add('chooseCourseButtonNotSelected');
                        this.videoCourseButton.classList.remove('chooseCourseButtonSelected');
                        this.videoCourseButton.disabled = false;
                        this.trainerExampleLink.style.display = 'inline';
                        this.longreadExampleLink.style.display = 'none';
                        this.videoCourseExampleLink.style.display = 'none';
                        this.renderUnitList(this.#useCases.trainerFilter());
                        this.calcHide.style.display = 'block';
                    });

                    this.unitList = document.getElementById('unitList');
                    this.cartUnits = document.getElementById('calcInCart');
                    this.cartQuantity = document.getElementById('unitQuantity');
                    this.cartPrices = document.getElementById('unitPrice');
                    this.rubleButton = document.getElementById('rubleButton');
                    this.rubleButton.addEventListener('click', this.onRuble);
                    this.dollarButton = document.getElementById('dollarButton');
                    this.dollarButton.addEventListener('click', this.onDollar);
                    this.tengeButton = document.getElementById('tengeButton');
                    this.tengeButton.addEventListener('click', this.onTenge);
                    this.calcSubmitButton = document.getElementById('calcSubmitButton');
                    this.calcSubmitButton.addEventListener('click', this.openModalWindow1);
                    this.userDataWindow = document.getElementById('userDataWindow');
                    this.calcModalClose1 = document.getElementById('calcModalClose1');
                    this.calcModalClose1.addEventListener('click', this.closeModalWindow1);
                    this.calcDark = document.getElementById('calcDark');
                    this.calcUserForm = document.getElementById('calcUserForm');
                    this.calcUserForm.addEventListener('submit', this.submitCalc);
                    this.calcModalClose2 = document.getElementById('calcModalClose2');
                    this.calcModalClose2.addEventListener('click', this.closeModalWindow2);
                    this.thanksWindow = document.getElementById('thanksWindow');
                }

                openCalc = () => {
                    const calc = document.getElementById('calcWrapper');
                    calc.style.display = 'block';
                }

                renderUnitList = (units) => {
                    this.unitList.innerHTML = '';
                    units.forEach((unit, i) => {
                        const div = document.createElement('div');
                        div.className = 'unitCheckboxWrapper'
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.id = unit.id;
                        input.dataset.index = unit.index;
                        input.className = 'unitAtList';
                        if (unit.quantityInCart) {
                            input.checked = true;
                        }
                        input.onchange = this.selectFromUnitList;
                        const label = document.createElement('label');
                        label.htmlFor = input.id;
                        label.className = 'unitLabel'
                        const textContent = document.createTextNode(unit.name);
                        label.appendChild(textContent);
                        div.appendChild(input);
                        div.appendChild(label);
                        this.unitList.appendChild(div)
                    })
                }

                selectFromUnitList = (event) => {
                    const units = this.#useCases.getUnits();
                    const unit = units[event.target.dataset.index];
                    if (unit.toolSwitcher) {
                        if (unit.toolSwitcher.trim().toLowerCase() == 'tilda') {
                            for (let i = 0; i < units.length; i++) {
                                if (units[i].quantityInCart && !units[i].TildaPossibility) {
                                    alert(`Нельзя выбрать "${unit.name}", когда в корзину добавлен "${units[i].name}"`);
                                    event.target.checked = !event.target.checked;
                                    return;
                                }
                            }
                        } else if (unit.toolSwitcher.trim().toLowerCase() == 'sl' && !unit.TildaPossibility && this.#useCases.getTildaSwitch()) {
                            alert(`Нельзя выбрать "${unit.name}", когда в корзину добавлена "Верстка курса на Tilda"`);
                            event.target.checked = !event.target.checked;
                            return;
                        }
                    }

                    if (event.target.checked) {
                        this.#useCases.addToCartByIndex(event.target.dataset.index);
                    } else {
                        this.#useCases.removeFromCartByIndex(event.target.dataset.index);
                    }
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                renderCart = () => {
                    this.cartUnits.innerHTML = '';
                    this.cartPrices.innerHTML = '';
                    this.cartQuantity.innerHTML = '';
                    let SLswitchers = 0;
                    let tildaSwitchers = 0;
                    let yesNoSwitcher = false;
                    let currency = '';
                    switch (this.#useCases.getCurrency()) {
                        case 'RUB':
                            currency = '₽';
                            break;
                        case 'USD':
                            currency = '$';
                            break;
                        case 'KZT':
                            currency = '₸';
                            break;
                    }
                    this.#useCases.getUnits().forEach((unit, i) => {
                        if (unit.quantityInCart) {
                            const inCartLineUnit = document.createElement('div');
                            inCartLineUnit.className = 'inCartLineUnit';
                            inCartLineUnit.dataset.index = unit.index;
                            inCartLineUnit.addEventListener('mouseover', () => {
                            });
                            inCartLineUnit.addEventListener('mouseleave', () => {
                            })
                            const inCartLinePrice = document.createElement('div');
                            inCartLinePrice.dataset.index = unit.index;
                            inCartLinePrice.className = 'inCartLinePrice';
                            inCartLinePrice.addEventListener('mouseover', () => {
                            });
                            inCartLinePrice.addEventListener('mouseleave', () => {
                            })
                            const textContentUnit = document.createTextNode(unit.name);
                            const textContentPrice = document.createTextNode(unit.fullPrice.toFixed(2) + ' ' + currency);
                            const quantityWrapper = document.createElement('div');
                            if (!unit.single) {
                                const plus = document.createElement('button');
                                quantityWrapper.appendChild(plus);
                                const textPlus = document.createTextNode('+');
                                plus.appendChild(textPlus);
                                plus.className = 'calcPlusMinus';
                                plus.dataset.index = unit.index;
                                plus.addEventListener('click', () => this.onPlus(unit.index));
                            }
                            const quantity = document.createElement('span');
                            quantityWrapper.appendChild(quantity);
                            const quantityText = document.createTextNode(' ' + unit.quantityInCart + ' ');
                            quantity.appendChild(quantityText);
                            const minus = document.createElement('button');
                            quantityWrapper.appendChild(minus);
                            const textMinus = document.createTextNode('-');
                            minus.appendChild(textMinus);
                            minus.className = 'calcPlusMinus';
                            minus.dataset.index = unit.index;
                            minus.addEventListener('click', () => this.onMinus(unit.index));
                            inCartLineUnit.appendChild(textContentUnit);
                            inCartLinePrice.appendChild(textContentPrice);
                            this.cartUnits.appendChild(inCartLineUnit);
                            this.cartPrices.appendChild(inCartLinePrice);
                            this.cartQuantity.appendChild(quantityWrapper);
                            if (unit.toolSwitcher) {
                                if (unit.toolSwitcher.trim().toLowerCase() == 'sl') {
                                    SLswitchers++;
                                }
                                if (unit.toolSwitcher.trim().toLowerCase() == 'tilda') {
                                    tildaSwitchers++;
                                }
                            }
                            if (unit.id == YES_NO_BUTTON_UNIT_ID) {
                                yesNoSwitcher = true;
                            }
                        }
                    })
                    if (Boolean(SLswitchers) != this.#useCases.getSLswitch()) {
                        if (this.#useCases.getSLswitch()) {
                            this.#useCases.slSwitchOff();
                        } else {
                            this.#useCases.slSwitchOn();
                        }
                        this.renderCart();
                    }
                    if (Boolean(tildaSwitchers) != this.#useCases.getTildaSwitch()) {
                        if (this.#useCases.getTildaSwitch()) {
                            this.#useCases.tildaSwitchOff();
                        } else {
                            this.#useCases.tildaSwitchOn();
                        }
                        this.renderCart();
                    }
                    if (yesNoSwitcher) {
                        this.onYesVisual();
                    } else {
                        this.onNoVisual();
                    }
                    const totalPrice = document.getElementById('totalPrice');
                    const textContentTotal = document.createTextNode(`${this.#useCases.getTotal().toFixed(2).toString()} ${currency}`);
                    totalPrice.innerHTML = '';
                    totalPrice.appendChild(textContentTotal);
                    if (this.#useCases.getTotal()) {
                        this.calcSubmitButton.disabled = false;
                    } else {
                        this.calcSubmitButton.disabled = true;
                    }
                };

                onPlus = (index) => {
                    this.#useCases.quantityInCartIncrement(index);
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                onMinus = (index) => {
                    this.#useCases.quantityInCartDecrement(index);
                    const unit = this.#useCases.getUnits()[index];
                    if (unit.quantityInCart == 0) {
                        const check = document.getElementById(unit.id);
                        if (check) {
                            check.checked = false;
                        }
                    }
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                onYes = () => {
                    this.#useCases.addToCartById(YES_NO_BUTTON_UNIT_ID);
                    this.renderUnitListWithFilters();
                    this.#useCases.setTotal();
                    this.renderCart();
                }

                onYesVisual = () => {
                    this.SLYesButton.classList.remove('calcButton');
                    this.SLYesButton.classList.add('calcButtonPressed');
                    this.SLYesButton.disabled = true;
                    this.SLNoButton.disabled = false;
                    this.SLNoButton.classList.remove('calcButtonPressed');
                    this.SLNoButton.classList.add('calcButton');
                    this.chooseCourseText.style.display = 'inline';
                    for (let chooseCourseButton of this.chooseCourseButtons) {
                        chooseCourseButton.style.display = 'inline';
                    }
                }

                onNo = () => {
                    this.#useCases.removeFromCartById(YES_NO_BUTTON_UNIT_ID);
                    this.renderUnitListWithFilters();
                    this.renderCart();
                }

                onNoVisual = () => {
                    this.SLNoButton.classList.remove('calcButton');
                    this.SLNoButton.classList.add('calcButtonPressed');
                    this.SLNoButton.disabled = true;
                    this.SLYesButton.disabled = false;
                    this.SLYesButton.classList.remove('calcButtonPressed');
                    this.SLYesButton.classList.add('calcButton');
                    this.chooseCourseText.style.display = 'inline';
                    for (let chooseCourseButton of this.chooseCourseButtons) {
                        chooseCourseButton.style.display = 'inline';
                    }
                }

                onRuble = () => {
                    this.#useCases.setRublePrice();
                    this.renderCart();
                };

                onDollar = () => {
                    this.#useCases.setDollarPrice();
                    this.renderCart();
                }

                onTenge = () => {
                    this.#useCases.setTengePrice();
                    this.renderCart();
                }

                renderUnitListWithFilters = () => {
                    switch (this.#filter) {
                        case 'LONGREAD':
                            this.renderUnitList(this.#useCases.longreadFilter());
                            break;
                        case 'VIDEOCOURSE':
                            this.renderUnitList(this.#useCases.videocourseFilter());
                            break;
                        case 'TRAINER':
                            this.renderUnitList(this.#useCases.trainerFilter());
                            break;
                    }
                }

                openModalWindow1 = () => {
                    this.userDataWindow.style.display = 'block';
                    this.calcDark.style.display = 'block';
                }

                openModalWindow2 = () => {
                    this.userDataWindow.style.display = 'none';
                    this.thanksWindow.style.display = 'block';
                }

                closeModalWindow1 = () => {
                    this.userDataWindow.style.display = 'none';
                    this.calcDark.style.display = 'none';
                }

                closeModalWindow2 = () => {
                    this.thanksWindow.style.display = 'none';
                    this.calcDark.style.display = 'none';
                }

                submitCalc = async (event) => {
                    event.preventDefault();
                    const {elements} = this.calcUserForm;
                    const data = Array.from(elements)
                        .filter((item) => !!item.name)
                        .map((element) => {
                            const {name, value} = element
                            return {name, value}
                        })
                    this.openModalWindow2();
                    this.#useCases.sendOrder(data);
                    this.#useCases.clearCart();
                    this.renderUnitListWithFilters();
                    this.renderCart();
                }
                static serverError = (error) => {
                    console.log(error);
                }
            };

            const run = async () => {
                let success = false;
                const data = new Data();
                try {
                    success = await data.getFromAPI();
                } catch (e) {
                    console.log('caught data.getFromAPI()');
                    Draw.serverError(e);
                }
                if (success) {
                    const useCases = new UseCases(data);
                    const draw = new Draw(useCases);
                    draw.openCalc();
                }
                try {
                    if (success) {
                        success = await data.fetchExchangeRates()
                    }
                } catch (e) {
                    console.log('caught data.fetchExchangeRates error')
                    Draw.serverError(e);
                }
                if (success) {
                    await data.setPrices();
                }
            }
            run();
        };
        calc();

    </script>
</div>
</body>
</html>